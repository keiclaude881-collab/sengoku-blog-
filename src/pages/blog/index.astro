---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import ArticleCard from "../../components/ArticleCard.astro";

const allPosts = (await Promise.all([
  getCollection("battle"),
  getCollection("leader"),
  getCollection("strategy"),
  getCollection("books"),
])).flat().sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

function slug(col: string, id: string) {
  return `${col}/${id.replace(/\.mdx?$/, '')}`;
}
---

<BaseLayout
  title="記事一覧 | 戦略の系譜"
  description="戦国・兵法・武将の戦略を現代ビジネスに応用する記事の一覧。"
>
  <div class="container">
    <header class="page-header">
      <h1>記事一覧</h1>
      <p>全 {allPosts.length} 記事</p>
    </header>

    {allPosts.length > 0 ? (
      <ul class="article-grid" role="list">
        {allPosts.map(post => (
          <li>
            <ArticleCard
              title={post.data.title}
              description={post.data.description}
              date={post.data.date}
              category={post.data.category}
              tags={post.data.tags}
              readingTime={post.data.readingTime}
              lesson={post.data.lesson}
              slug={slug(post.collection, post.id)}
            />
          </li>
        ))}
      </ul>
    ) : (
      <p class="empty">記事はまもなく公開されます。</p>
    )}
  </div>
</BaseLayout>

<style>
  .empty {
    text-align: center;
    color: var(--gray-light);
    padding: var(--sp-xl);
    font-family: var(--font-sans);
    font-size: 0.85rem;
  }
</style>
