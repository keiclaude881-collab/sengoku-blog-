---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ArticleFeatured from "../components/ArticleFeatured.astro";
import ArticleCard from "../components/ArticleCard.astro";
import BookCard from "../components/BookCard.astro";
import AffiliateDisclosure from "../components/AffiliateDisclosure.astro";

const allArticles = (await Promise.all([
  getCollection("battle"),
  getCollection("leader"),
  getCollection("strategy"),
  getCollection("books"),
])).flat().sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const featured = allArticles.find(a => a.data.featured) ?? allArticles[0];
const recent   = allArticles.filter(a => a.id !== featured?.id).slice(0, 4);

function slug(col: string, id: string) {
  return `${col}/${id.replace(/\.mdx?$/, '')}`;
}

const featuredBooks = [
  { title: "å­«å­ã®å…µæ³• ç¾ä»£èªè¨³ãƒ»è§£èª¬ç‰ˆ", asin: "4569841821", reason: "æƒ…å ±æˆ¦ã®åŸå…¸ã€‚ç«¶åˆåˆ†æã®åŸºç¤ãŒå‡ç¸®ã•ã‚Œã¦ã„ã‚‹" },
  { title: "äº”è¼ªæ›¸ï¼ˆå®®æœ¬æ­¦è”µï¼‰å²©æ³¢æ–‡åº«", asin: "4003321715", reason: "å€‹ã®å¼·ã•ã¨ã¯ä½•ã‹ã€‚æ­¦è”µã®æˆ¦ç•¥å“²å­¦ã‚’å­¦ã¶" },
  { title: "æˆ¦ç•¥ã®æœ¬è³ª", asin: "4532352428", reason: "æ—¥æœ¬ã®åˆæˆ¦ã‚’çµŒå–¶æˆ¦ç•¥ã®è¦–ç‚¹ã§å†è§£é‡ˆã—ãŸåè‘—" },
  { title: "å¤±æ•—ã®æœ¬è³ª", asin: "4122018331", reason: "ãªãœæ—¥æœ¬è»ã¯è² ã‘ãŸã®ã‹ã€‚çµ„ç¹”è«–ã®å¤å…¸" },
];
---

<BaseLayout
  title="æˆ¦ç•¥ã®ç³»è­œ | æ­´å²ã®æˆ¦ç•¥ã‚’ã€ç¾ä»£ã®æ­¦å™¨ã«ã€‚"
  description="æˆ¦å›½ãƒ»å…µæ³•ã®çŸ¥æµã‚’ç¾ä»£ã®ãƒ“ã‚¸ãƒã‚¹ãƒ»äº¤æ¸‰ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã«å¿œç”¨ã™ã‚‹æ—¥æœ¬å²Ã—æˆ¦ç•¥æ€è€ƒãƒ–ãƒ­ã‚°ã€‚"
>
  <Hero />

  <!-- æœ€æ–°è¨˜äº‹ -->
  {allArticles.length > 0 && (
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">æœ€æ–°è¨˜äº‹</h2>
          <a href="/blog/" class="section-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
        </div>

        {featured && (
          <ArticleFeatured
            title={featured.data.title}
            description={featured.data.description}
            date={featured.data.date}
            category={featured.data.category}
            tags={featured.data.tags}
            readingTime={featured.data.readingTime}
            lesson={featured.data.lesson}
            slug={slug(featured.collection, featured.id)}
          />
        )}

        {recent.length > 0 && (
          <ul class="article-grid" role="list">
            {recent.map(post => (
              <li>
                <ArticleCard
                  title={post.data.title}
                  description={post.data.description}
                  date={post.data.date}
                  category={post.data.category}
                  tags={post.data.tags}
                  readingTime={post.data.readingTime}
                  lesson={post.data.lesson}
                  slug={slug(post.collection, post.id)}
                />
              </li>
            ))}
          </ul>
        )}
      </div>
    </section>
  )}

  <!-- ã‚«ãƒ†ã‚´ãƒª -->
  <section class="cat-section section fade-in">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">ã‚«ãƒ†ã‚´ãƒª</h2>
      </div>
      <ul class="cat-grid" role="list">
        {[
          { cat: "battle",   icon: "âš”", label: "åˆæˆ¦åˆ†æ",      desc: "å„åœ°ã®ååˆæˆ¦ã®æˆ¦è¡“ãƒ»æˆ¦ç•¥ã‚’å¾¹åº•è§£èª¬" },
          { cat: "leader",   icon: "ğŸ¯", label: "æ­¦å°†ã®æ€æƒ³",    desc: "è‹±å‚‘ãŸã¡ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨æ€è€ƒæ³•" },
          { cat: "strategy", icon: "ğŸ“œ", label: "å…µæ³•ãƒ»ç¾ä»£å¿œç”¨", desc: "å­«å­ãƒ»äº”è¼ªæ›¸ã®ç¾ä»£ãƒ“ã‚¸ãƒã‚¹ã¸ã®å¿œç”¨" },
          { cat: "books",    icon: "ğŸ“š", label: "æ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼",   desc: "æ­´å²Ã—æˆ¦ç•¥ã§å³é¸ã—ãŸæ¨è–¦å›³æ›¸" },
        ].map(({ cat, icon, label, desc }) => (
          <li>
            <a href={`/category/${cat}/`} class="cat-card">
              <span class="cat-icon" aria-hidden="true">{icon}</span>
              <span class="cat-name">{label}</span>
              <span class="cat-desc">{desc}</span>
              <span class="cat-arrow">â†’</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </section>

  <!-- æ›¸ç±ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚¾ãƒ¼ãƒ³ -->
  <section class="books-zone" aria-label="ãŠã™ã™ã‚æ›¸ç±">
    <div class="container">
      <div class="section-header books-header">
        <h2 class="section-title books-title">ã“ã®æˆ¦ç•¥ã‚’æ·±ãå­¦ã¶ã€ä¸€å†Šã€‚</h2>
        <a href="/books/" class="books-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <AffiliateDisclosure />
      <div class="book-grid">
        {featuredBooks.map(b => (
          <BookCard title={b.title} asin={b.asin} reason={b.reason} />
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .cat-section { background: var(--bg-sub); }

  .cat-grid {
    list-style: none;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .cat-card {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
    padding: 1.8rem 1.4rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    text-decoration: none;
    color: inherit;
    transition: box-shadow 0.25s, border-color 0.25s, transform 0.25s;
    position: relative;
  }
  .cat-card:hover {
    box-shadow: 0 4px 16px rgba(15, 39, 68, 0.1);
    border-color: var(--orange);
    transform: translateY(-2px);
  }
  .cat-card:hover .cat-arrow { color: var(--orange); }

  .cat-icon { font-size: 1.8rem; line-height: 1; }
  .cat-name {
    font-family: var(--font-serif);
    font-size: 1rem;
    font-weight: 700;
    color: var(--text);
    letter-spacing: 0.03em;
  }
  .cat-desc {
    font-family: var(--font-sans);
    font-size: 0.75rem;
    font-weight: 400;
    color: var(--text-mid);
    line-height: 1.6;
    flex: 1;
  }
  .cat-arrow {
    font-family: var(--font-sans);
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-sub);
    transition: color 0.2s;
    margin-top: auto;
  }

  /* æ›¸ç±ã‚¾ãƒ¼ãƒ³ */
  .books-zone {
    background: var(--bg-navy);
    padding: var(--sp-xl) 0;
    position: relative;
    overflow: hidden;
  }
  .books-zone::before {
    content: "èª­";
    font-family: var(--font-serif);
    font-size: 40rem;
    font-weight: 800;
    color: rgba(232, 85, 45, 0.04);
    position: absolute;
    right: -6rem;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    line-height: 1;
    user-select: none;
  }

  .books-header { border-bottom-color: rgba(255, 255, 255, 0.12); }
  .books-title { color: #fff; }
  .books-more {
    font-family: var(--font-sans);
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--orange);
    transition: color 0.2s;
  }
  .books-more:hover { color: var(--amber); }

  .books-zone :global(.affiliate-disclosure) {
    color: rgba(255, 255, 255, 0.35);
    margin-bottom: 1.5rem;
  }

  .book-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.2rem;
    margin-top: 1.5rem;
  }

  @media (max-width: 1024px) {
    .cat-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 768px) {
    .cat-grid { grid-template-columns: repeat(2, 1fr); }
    .book-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) {
    .cat-grid { grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .book-grid { grid-template-columns: 1fr 1fr; gap: 0.8rem; }
  }
</style>
