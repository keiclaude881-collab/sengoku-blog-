---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ArticleFeatured from "../components/ArticleFeatured.astro";
import ArticleCard from "../components/ArticleCard.astro";
import BookCard from "../components/BookCard.astro";
import AffiliateDisclosure from "../components/AffiliateDisclosure.astro";

const allArticles = (await Promise.all([
  getCollection("battle"),
  getCollection("leader"),
  getCollection("strategy"),
  getCollection("books"),
])).flat().sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const featured = allArticles.find(a => a.data.featured) ?? allArticles[0];
const recent   = allArticles.filter(a => a.id !== featured?.id).slice(0, 4);

function slug(col: string, id: string) {
  return `${col}/${id.replace(/\.mdx?$/, '')}`;
}

const featuredBooks = [
  { title: "å­«å­ã®å…µæ³• ç¾ä»£èªè¨³ãƒ»è§£èª¬ç‰ˆ", asin: "4569841821", reason: "æƒ…å ±æˆ¦ã®åŸå…¸ã€‚ç«¶åˆåˆ†æã®åŸºç¤ãŒå‡ç¸®ã•ã‚Œã¦ã„ã‚‹" },
  { title: "äº”è¼ªæ›¸ï¼ˆå®®æœ¬æ­¦è”µï¼‰å²©æ³¢æ–‡åº«", asin: "4003321715", reason: "å€‹ã®å¼·ã•ã¨ã¯ä½•ã‹ã€‚æ­¦è”µã®æˆ¦ç•¥å“²å­¦ã‚’å­¦ã¶" },
  { title: "æˆ¦ç•¥ã®æœ¬è³ª", asin: "4532352428", reason: "æ—¥æœ¬ã®åˆæˆ¦ã‚’çµŒå–¶æˆ¦ç•¥ã®è¦–ç‚¹ã§å†è§£é‡ˆã—ãŸåè‘—" },
  { title: "å¤±æ•—ã®æœ¬è³ª", asin: "4122018331", reason: "ãªãœæ—¥æœ¬è»ã¯è² ã‘ãŸã®ã‹ã€‚çµ„ç¹”è«–ã®å¤å…¸" },
];
---

<BaseLayout
  title="æˆ¦ç•¥ã®ç³»è­œ | æ­´å²ã®æˆ¦ç•¥ã‚’ã€ç¾ä»£ã®æ­¦å™¨ã«ã€‚"
  description="æˆ¦å›½ãƒ»å…µæ³•ã®çŸ¥æµã‚’ç¾ä»£ã®ãƒ“ã‚¸ãƒã‚¹ãƒ»äº¤æ¸‰ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã«å¿œç”¨ã™ã‚‹æ—¥æœ¬å²Ã—æˆ¦ç•¥æ€è€ƒãƒ–ãƒ­ã‚°ã€‚"
>
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ -->
  <Hero />

  <!-- ã‚³ãƒ³ã‚»ãƒ—ãƒˆ -->
  <section class="concept section fade-in">
    <div class="container">
      <p class="concept-text">
        ã€Œæ­´å²ã¯ç¹°ã‚Šè¿”ã™ã€â€”â€”ã—ã‹ã—ãã‚Œã¯ã€åŒã˜å¤±æ•—ã‚’çŠ¯ã—ç¶šã‘ã‚‹ã“ã¨ã‚’æ„å‘³ã—ãªã„ã€‚<br />
        å…ˆäººãŸã¡ã®æˆ¦ç•¥ã‚’å­¦ã³ã€ç¾ä»£ã®æ–‡è„ˆã«ç¿»è¨³ã™ã‚‹ã“ã¨ã§ã€ã‚ãªãŸã®æ€è€ƒã¯é‹­ããªã‚‹ã€‚
      </p>
    </div>
  </section>

  <!-- æœ€æ–°è¨˜äº‹ -->
  {allArticles.length > 0 && (
    <section class="section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">æœ€æ–°è¨˜äº‹</h2>
          <a href="/blog/" class="section-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
        </div>

        {featured && (
          <ArticleFeatured
            title={featured.data.title}
            description={featured.data.description}
            date={featured.data.date}
            category={featured.data.category}
            tags={featured.data.tags}
            readingTime={featured.data.readingTime}
            lesson={featured.data.lesson}
            slug={slug(featured.collection, featured.id)}
          />
        )}

        {recent.length > 0 && (
          <ul class="article-grid" role="list">
            {recent.map(post => (
              <li>
                <ArticleCard
                  title={post.data.title}
                  description={post.data.description}
                  date={post.data.date}
                  category={post.data.category}
                  tags={post.data.tags}
                  readingTime={post.data.readingTime}
                  lesson={post.data.lesson}
                  slug={slug(post.collection, post.id)}
                />
              </li>
            ))}
          </ul>
        )}
      </div>
    </section>
  )}

  <!-- æ›¸ç±ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚¾ãƒ¼ãƒ³ -->
  <section class="books-zone" aria-label="ãŠã™ã™ã‚æ›¸ç±">
    <div class="books-zone-inner container">
      <div class="section-header books-header">
        <h2 class="section-title books-title">ã“ã®æˆ¦ç•¥ã‚’æ·±ãå­¦ã¶ã€ä¸€å†Šã€‚</h2>
        <a href="/books/" class="section-more books-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <AffiliateDisclosure />
      <div class="book-grid">
        {featuredBooks.map(b => (
          <BookCard title={b.title} asin={b.asin} reason={b.reason} />
        ))}
      </div>
    </div>
  </section>

  <!-- ã‚«ãƒ†ã‚´ãƒª -->
  <section class="section fade-in">
    <div class="container">
      <h2 class="section-title" style="margin-bottom: var(--sp-md);">ã‚«ãƒ†ã‚´ãƒª</h2>
      <ul class="cat-grid" role="list">
        {[
          { cat: "battle",   icon: "âš”", label: "åˆæˆ¦åˆ†æ",      desc: "å„åœ°ã®ååˆæˆ¦ã®æˆ¦è¡“ãƒ»æˆ¦ç•¥ã‚’å¾¹åº•è§£èª¬" },
          { cat: "leader",   icon: "ğŸ¯", label: "æ­¦å°†ã®æ€æƒ³",    desc: "è‹±å‚‘ãŸã¡ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨æ€è€ƒæ³•" },
          { cat: "strategy", icon: "ğŸ“œ", label: "å…µæ³•ãƒ»ç¾ä»£å¿œç”¨", desc: "å­«å­ãƒ»äº”è¼ªæ›¸ã®ç¾ä»£ãƒ“ã‚¸ãƒã‚¹ã¸ã®å¿œç”¨" },
        ].map(({ cat, icon, label, desc }) => (
          <li>
            <a href={`/category/${cat}/`} class="cat-card">
              <span class="cat-icon" aria-hidden="true">{icon}</span>
              <span class="cat-name">{label}</span>
              <span class="cat-desc">{desc}</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </section>
</BaseLayout>

<style>
  .concept {
    background: var(--bg-sub);
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    text-align: center;
  }
  .concept-text {
    font-family: var(--font-serif);
    font-size: clamp(0.9rem, 2vw, 1.1rem);
    font-weight: 400;
    line-height: 2.2;
    color: var(--text-mid);
    max-width: 680px;
    margin: 0 auto;
  }

  .books-zone {
    background: var(--bg-dark);
    padding: var(--sp-xl) 0;
    position: relative;
    overflow: hidden;
  }
  .books-zone::before {
    content: "èª­";
    font-family: var(--font-serif);
    font-size: 30rem;
    font-weight: 800;
    color: rgba(192, 57, 43, 0.05);
    position: absolute;
    right: -4rem;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    line-height: 1;
  }
  .books-zone-inner { position: relative; z-index: 1; }

  /* Override section-header colors for dark bg */
  .books-header { border-bottom-color: rgba(255, 255, 255, 0.1); }
  .books-title { color: var(--bg); }
  .books-more { color: rgba(255, 255, 255, 0.45); }
  .books-more:hover { color: var(--red); }

  /* AffiliateDisclosure override for dark bg */
  .books-zone :global(.affiliate-disclosure) {
    color: rgba(255, 255, 255, 0.35);
  }

  .book-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-top: 1.6rem;
  }

  .cat-grid {
    list-style: none;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1px;
    background: var(--border);
    border: 1px solid var(--border);
  }

  .cat-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 0.6rem;
    padding: 2.4rem 1.6rem;
    background: var(--bg);
    text-decoration: none;
    color: inherit;
    transition: background 0.3s;
  }
  .cat-card:hover { background: var(--bg-sub); }

  .cat-icon { font-size: 2rem; line-height: 1; }
  .cat-name {
    font-family: var(--font-serif);
    font-size: 1.05rem;
    font-weight: 600;
    letter-spacing: 0.04em;
  }
  .cat-desc {
    font-family: var(--font-sans);
    font-size: 0.75rem;
    font-weight: 400;
    color: var(--text-mid);
    line-height: 1.6;
  }

  @media (max-width: 768px) {
    .book-grid { grid-template-columns: repeat(2, 1fr); }
    .cat-grid  { grid-template-columns: 1fr; }
  }
  @media (max-width: 480px) {
    .book-grid { grid-template-columns: 1fr 1fr; gap: 0.8rem; }
  }
</style>
