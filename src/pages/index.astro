---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Hero from "../components/Hero.astro";
import ArticleFeatured from "../components/ArticleFeatured.astro";
import ArticleCard from "../components/ArticleCard.astro";
import BookCard from "../components/BookCard.astro";
import AffiliateDisclosure from "../components/AffiliateDisclosure.astro";

const allArticles = (await Promise.all([
  getCollection("battle"),
  getCollection("leader"),
  getCollection("strategy"),
  getCollection("books"),
])).flat().sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const featured = allArticles.find(a => a.data.featured) ?? allArticles[0];
const recent   = allArticles.filter(a => a.id !== featured?.id).slice(0, 4);

function slug(col: string, id: string) {
  return `${col}/${id.replace(/\.mdx?$/, '')}`;
}

const featuredBooks = [
  { title: "å­«å­ã®å…µæ³• ç¾ä»£èªè¨³ãƒ»è§£èª¬ç‰ˆ", asin: "4569841821", reason: "æƒ…å ±æˆ¦ã®åŸå…¸ã€‚ç«¶åˆåˆ†æã®åŸºç¤ãŒå‡ç¸®ã•ã‚Œã¦ã„ã‚‹" },
  { title: "äº”è¼ªæ›¸ï¼ˆå®®æœ¬æ­¦è”µï¼‰å²©æ³¢æ–‡åº«", asin: "4003321715", reason: "å€‹ã®å¼·ã•ã¨ã¯ä½•ã‹ã€‚æ­¦è”µã®æˆ¦ç•¥å“²å­¦ã‚’å­¦ã¶" },
  { title: "æˆ¦ç•¥ã®æœ¬è³ª", asin: "4532352428", reason: "æ—¥æœ¬ã®åˆæˆ¦ã‚’çµŒå–¶æˆ¦ç•¥ã®è¦–ç‚¹ã§å†è§£é‡ˆã—ãŸåè‘—" },
  { title: "å¤±æ•—ã®æœ¬è³ª", asin: "4122018331", reason: "ãªãœæ—¥æœ¬è»ã¯è² ã‘ãŸã®ã‹ã€‚çµ„ç¹”è«–ã®å¤å…¸" },
];
---

<BaseLayout
  title="æˆ¦ç•¥ã®ç³»è­œ | æˆ¦å›½æ­¦å°†ã®åˆ¤æ–­ãŒã€ã‚ãªãŸã®æ­£è§£ã«ãªã‚‹ã€‚"
  description="åˆæˆ¦ãƒ»æ­¦å°†ãƒ»å…µæ³•ã‹ã‚‰å­¦ã¶ç¾ä»£ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥ãƒ–ãƒ­ã‚°ã€‚é–¢ãƒ¶åŸã€å·ä¸­å³¶ã€ä¿¡é•·ãƒ»å®¶åº·ã®åˆ¤æ–­ã‚’ç¾ä»£èªã«ç¿»è¨³ã™ã‚‹ã€‚"
>
  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ -->
  <Hero />

  <!-- WHYã‚¹ãƒˆãƒªãƒƒãƒ—ï¼šãªãœæ­´å²ã‹ã‚‰å­¦ã¶ã®ã‹ -->
  <section class="why-strip">
    <div class="container">
      <p class="why-lead">ãªãœã€500å¹´å‰ã®æˆ¦ç•¥ãŒä»Šã‚‚é€šç”¨ã™ã‚‹ã®ã‹ï¼Ÿ</p>
      <div class="why-grid">
        <div class="why-card">
          <span class="why-icon">âš”</span>
          <h3>åˆæˆ¦ã¯ã€Œæœ€é«˜ã®æ„æ€æ±ºå®šå®Ÿé¨“å®¤ã€ã ã£ãŸ</h3>
          <p>å‘½ãŒã‹ã‹ã£ãŸçŠ¶æ³ã§ã®åˆ¤æ–­ã¯ã€çµŒå–¶ã®æ¥µé™çŠ¶æ…‹ã¨åŒã˜æ§‹é€ ã‚’ã—ã¦ã„ã‚‹ã€‚</p>
        </div>
        <div class="why-card">
          <span class="why-icon">ğŸ¯</span>
          <h3>å‹è€…ã®å…±é€šç‚¹ã¯ã€Œå†ç¾å¯èƒ½ã€ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã </h3>
          <p>ä¿¡é•·ã®ç ´å£Šçš„ã‚¤ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã€å®¶åº·ã®é•·æœŸæˆ¦ç•¥â€”â€”æˆåŠŸã«ã¯å¿…ãšæ³•å‰‡ãŒã‚ã‚‹ã€‚</p>
        </div>
        <div class="why-card">
          <span class="why-icon">ğŸ“–</span>
          <h3>ä¸€å†Šã®æœ¬ã‚ˆã‚Šã€ä¸€ã¤ã®åˆæˆ¦ã‹ã‚‰å­¦ã¹ã‚‹</h3>
          <p>å­«å­ã®å…µæ³•ã‚‚ã€å®Ÿã¯åˆæˆ¦ã¨ã„ã†å®Ÿä¾‹ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸç†è«–ã€‚æ­´å²ã¯æœ€è‰¯ã®ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£ã ã€‚</p>
        </div>
      </div>
    </div>
  </section>

  <!-- è¨˜äº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  {allArticles.length > 0 && (
    <section class="section articles-section">
      <div class="container">
        <div class="section-header">
          <h2 class="section-title">æ³¨ç›®è¨˜äº‹</h2>
          <a href="/blog/" class="section-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
        </div>

        {featured && (
          <ArticleFeatured
            title={featured.data.title}
            description={featured.data.description}
            date={featured.data.date}
            category={featured.data.category}
            tags={featured.data.tags}
            readingTime={featured.data.readingTime}
            lesson={featured.data.lesson}
            slug={slug(featured.collection, featured.id)}
          />
        )}

        {recent.length > 0 && (
          <ul class="article-grid" role="list">
            {recent.map(post => (
              <li>
                <ArticleCard
                  title={post.data.title}
                  description={post.data.description}
                  date={post.data.date}
                  category={post.data.category}
                  tags={post.data.tags}
                  readingTime={post.data.readingTime}
                  lesson={post.data.lesson}
                  slug={slug(post.collection, post.id)}
                />
              </li>
            ))}
          </ul>
        )}
      </div>
    </section>
  )}

  <!-- ã‚«ãƒ†ã‚´ãƒª -->
  <section class="cat-section section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">ã©ã®è¦–ç‚¹ã‹ã‚‰åˆ‡ã‚Šè¾¼ã‚€ï¼Ÿ</h2>
      </div>
      <ul class="cat-grid" role="list">
        {[
          {
            cat: "battle",
            icon: "âš”",
            label: "åˆæˆ¦åˆ†æ",
            hook: "ãªãœã‚ã®æˆ¦ã„ã¯ã€ãã®çµæœ«ã«ãªã£ãŸã®ã‹",
            desc: "é–¢ãƒ¶åŸãƒ»å·ä¸­å³¶ãƒ»æ¡¶ç‹­é–“ã‚’ç¾ä»£ã®è¦–ç‚¹ã§è§£å‰–ã™ã‚‹",
          },
          {
            cat: "leader",
            icon: "ğŸ¯",
            label: "æ­¦å°†ã®æ€æƒ³",
            hook: "ä¿¡é•·ã¯ãªãœã€æ—¢å­˜ã®ç§©åºã‚’å£Šã›ãŸã®ã‹",
            desc: "è‹±å‚‘ãŸã¡ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¨æ„æ€æ±ºå®šã®æ·±å±¤",
          },
          {
            cat: "strategy",
            icon: "ğŸ“œ",
            label: "å…µæ³•ãƒ»ç¾ä»£å¿œç”¨",
            hook: "å­«å­ã®è¨€è‘‰ã¯ã€ä¼šè­°å®¤ã§ã‚‚ä½¿ãˆã‚‹ã‹",
            desc: "å¤å…¸å…µæ³•ã‚’ãƒ“ã‚¸ãƒã‚¹ãƒ»äº¤æ¸‰ãƒ»çµ„ç¹”è«–ã«ç¿»è¨³ã™ã‚‹",
          },
          {
            cat: "books",
            icon: "ğŸ“š",
            label: "æ›¸ç±ãƒ¬ãƒ“ãƒ¥ãƒ¼",
            hook: "ã“ã®ä¸€å†ŠãŒã€ã‚ãªãŸã®æ€è€ƒã‚’å¤‰ãˆã‚‹",
            desc: "æ­´å²Ã—æˆ¦ç•¥ã§å³é¸ã—ãŸæ¨è–¦å›³æ›¸ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼",
          },
        ].map(({ cat, icon, label, hook, desc }) => (
          <li>
            <a href={`/category/${cat}/`} class="cat-card">
              <div class="cat-header">
                <span class="cat-icon" aria-hidden="true">{icon}</span>
                <span class="cat-name">{label}</span>
              </div>
              <p class="cat-hook">{hook}</p>
              <p class="cat-desc">{desc}</p>
              <span class="cat-link">è¨˜äº‹ä¸€è¦§ â†’</span>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </section>

  <!-- æ›¸ç±ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ -->
  <section class="books-zone" aria-label="ãŠã™ã™ã‚æ›¸ç±">
    <div class="books-deco" aria-hidden="true">èª­</div>
    <div class="container books-inner">
      <div class="section-header books-header">
        <h2 class="section-title books-title">æˆ¦ç•¥ã‚’æ·±ã‚ã‚‹ã€å³é¸ã®ä¸€å†Šã€‚</h2>
        <a href="/books/" class="books-more">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <p class="books-lead">è¨˜äº‹ã‚’èª­ã‚“ã§ã€Œã‚‚ã£ã¨æ·±ãçŸ¥ã‚ŠãŸã„ã€ã¨æ€ã£ãŸã‚‰ã€ã“ã®æœ¬ã‹ã‚‰å§‹ã‚ã‚ˆã†ã€‚</p>
      <AffiliateDisclosure />
      <div class="book-grid">
        {featuredBooks.map(b => (
          <BookCard title={b.title} asin={b.asin} reason={b.reason} />
        ))}
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* â”€â”€ WHYã‚¹ãƒˆãƒªãƒƒãƒ— â”€â”€ */
  .why-strip {
    background: var(--bg-sub);
    padding: var(--sp-lg) 0;
    border-top: 1px solid var(--border);
    border-bottom: 3px solid var(--orange);
  }

  .why-lead {
    font-family: var(--font-serif);
    font-size: clamp(1rem, 2vw, 1.25rem);
    font-weight: 700;
    color: var(--text);
    text-align: center;
    margin-bottom: 2.4rem;
    letter-spacing: 0.02em;
  }

  .why-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .why-card {
    background: var(--bg);
    padding: 1.8rem;
    border-radius: 4px;
    border-top: 3px solid transparent;
    transition: border-color 0.25s;
  }
  .why-card:hover { border-top-color: var(--orange); }

  .why-icon {
    display: block;
    font-size: 1.8rem;
    margin-bottom: 1rem;
    line-height: 1;
  }

  .why-card h3 {
    font-family: var(--font-serif);
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--text);
    line-height: 1.5;
    margin-bottom: 0.7rem;
    letter-spacing: 0.02em;
  }

  .why-card p {
    font-family: var(--font-sans);
    font-size: 0.82rem;
    font-weight: 400;
    color: var(--text-mid);
    line-height: 1.75;
  }

  /* â”€â”€ è¨˜äº‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€ */
  .articles-section { background: var(--bg); }

  /* â”€â”€ ã‚«ãƒ†ã‚´ãƒª â”€â”€ */
  .cat-section { background: var(--bg-sub); }

  .cat-grid {
    list-style: none;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
  }

  .cat-card {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    padding: 1.8rem 1.4rem;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    text-decoration: none;
    color: inherit;
    transition: box-shadow 0.25s, border-color 0.25s, transform 0.25s;
    height: 100%;
  }
  .cat-card:hover {
    box-shadow: 0 4px 20px rgba(26, 10, 10, 0.09);
    border-color: var(--orange);
    transform: translateY(-2px);
  }
  .cat-card:hover .cat-link { color: var(--orange-dark); }

  .cat-header {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    margin-bottom: 0.3rem;
  }

  .cat-icon { font-size: 1.5rem; line-height: 1; }

  .cat-name {
    font-family: var(--font-sans);
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--orange);
    text-transform: uppercase;
  }

  .cat-hook {
    font-family: var(--font-serif);
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--text);
    line-height: 1.5;
    letter-spacing: 0.01em;
  }

  .cat-desc {
    font-family: var(--font-sans);
    font-size: 0.78rem;
    font-weight: 400;
    color: var(--text-mid);
    line-height: 1.65;
    flex: 1;
  }

  .cat-link {
    font-family: var(--font-sans);
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--orange);
    margin-top: auto;
    transition: color 0.2s;
  }

  /* â”€â”€ æ›¸ç±ã‚¾ãƒ¼ãƒ³ â”€â”€ */
  .books-zone {
    background: var(--bg-navy);
    padding: var(--sp-xl) 0;
    position: relative;
    overflow: hidden;
  }

  .books-deco {
    position: absolute;
    right: -3rem;
    top: 50%;
    transform: translateY(-50%);
    font-family: var(--font-serif);
    font-size: 40rem;
    font-weight: 800;
    color: rgba(185, 28, 28, 0.05);
    line-height: 1;
    pointer-events: none;
    user-select: none;
  }

  .books-inner { position: relative; z-index: 1; }

  .books-header { border-bottom-color: rgba(255,255,255,0.1); }
  .books-title { color: #fff; }
  .books-more {
    font-family: var(--font-sans);
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--orange);
    transition: color 0.2s;
  }
  .books-more:hover { color: var(--amber); }

  .books-lead {
    font-family: var(--font-serif);
    font-size: 0.9rem;
    color: rgba(255,255,255,0.55);
    margin-bottom: 0.5rem;
    line-height: 1.8;
  }

  .books-zone :global(.affiliate-disclosure) {
    color: rgba(255,255,255,0.3);
    margin-bottom: 1.5rem;
  }

  .book-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.2rem;
    margin-top: 1.5rem;
  }

  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
  @media (max-width: 1024px) {
    .why-grid { grid-template-columns: repeat(3, 1fr); }
    .cat-grid  { grid-template-columns: repeat(2, 1fr); }
    .book-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 768px) {
    .why-grid  { grid-template-columns: 1fr; }
    .cat-grid  { grid-template-columns: repeat(2, 1fr); }
    .book-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 480px) {
    .cat-grid  { grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .book-grid { grid-template-columns: 1fr 1fr; gap: 0.8rem; }
  }
</style>
